<!DOCTYPE html>
<html>

  <head>
    <title>DOD Connection Client</title>
  </head>

  <body>

    <p/>
    <video width="426" height="240" controls>
      <!-- <source src="http://raspberrypi:8080/static/F9R_1000m_Fin_Flight_Onboard_Cam_and_Wide_Shot.mp4" type="video/mpeg4"> -->
      <!-- <source src="http://raspberrypi:8080/static/stream.mp4" type="video/mp4"> -->
      <source src="http://raspberrypi:8080/static/F9R_1000m_Fin_Flight_Onboard_Cam_and_Wide_Shot.ogg" type="video/ogg">
      Your browser does not support the video tag.
    </video> 
    <p>Forward proximity (m):</p><p id=proximity></p>

    <p><span style="font-weight:bold">DOD says:</span></p>
    <div id="output"></div>

    <script>

      var host = "ws://raspberrypi:8080/ws";
      var socket = new WebSocket(host);

      if(socket) {
        socket.onopen = function() {

          document.onkeydown = function KeyCheck(event) {

            var KeyID = event.which; 

            switch(KeyID) {
              case 16:
                socket.send("robot|drivetrain|stop");
                socket.send("robot|drivetrain|coast");
                break;
              case 37:
                socket.send("robot|drivetrain|left");
                break;
              case 38:
                socket.send("robot|drivetrain|forward");
                break;
              case 39:
                socket.send("robot|drivetrain|right");
                break;
              case 40:
                socket.send("robot|drivetrain|reverse");
                break;
              case 67:
                socket.send("robot|drivetrain|center");
                break;
              case 68:
                socket.send("robot|forward_range|get");
                break;
              }
            }

          document.onkeyup = function KeyCheck(event) {

            var KeyID = event.which; 

            switch(KeyID) {
              case 37:
                socket.send("robot|drivetrain|center");
                break;
              case 38:
                socket.send("robot|drivetrain|coast");
                break;
              case 39:
                socket.send("robot|drivetrain|center");
                break;
              case 40:
                socket.send("robot|drivetrain|coast");
                break;
              }
            }

          }

          socket.onmessage = function(msg) {
              showServerResponse(msg.data);
          }
          socket.onclose = function() {
              showServerResponse("Connection closed by server.");
          }
      } else {
          console.log("Invalid socket.");
      }

      function showServerResponse(txt) {
          if (txt.split("|")[1] == "forward_range"){
            var dist = parseFloat(txt.split("|")[2]);
            document.getElementById("proximity").innerHTML = dist.toFixed(3);
          } else {
            var p = document.createElement('p');
            p.innerHTML = txt;
            document.getElementById('output').appendChild(p);
          }
      }   

    </script>
  </body>
</html>

